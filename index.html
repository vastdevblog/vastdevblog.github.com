
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Vast Development Blog</title>
  <meta name="author" content="vast.com">

  
  <meta name="description" content="This is a short post about using Guice dependency injection
in Scala test cases that are configured with TestNG annotations.
The two interesting &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vast.com/vastdevblog">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Vast Development Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Vast Development Blog</a></h1>
  
    <h2>The vast.com development blog.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:vast.com/vastdevblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/23/handling-dependency-injection-in-scala-test-cases-with-testng/">Handling Dependency Injection in Scala Test Cases With TestNG</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-23T15:46:00-05:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a short post about using <a href="http://code.google.com/p/google-guice/">Guice</a> dependency injection
in Scala test cases that are configured with <a href="http://testng.org/doc/index.html">TestNG</a> annotations.
The two interesting points are</p>

<ul>
<li>How in Guice do you override production dependencies with test ones when you want to execute a test case?</li>
<li>How do you use TestNG with Scala?</li>
</ul>


<p>Here&#8217;s a simple example showing how this works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">org.testng.Assert._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">org.testng.annotations.</span><span class="o">{</span><span class="nc">Guice</span><span class="o">,</span> <span class="nc">Test</span><span class="o">}</span>
</span><span class='line'><span class="k">import</span> <span class="nn">org.testng.</span><span class="o">{</span><span class="nc">ITestContext</span><span class="o">,</span> <span class="nc">IModuleFactory</span><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Guice</span><span class="o">(</span><span class="n">moduleFactory</span> <span class="k">=</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">ExampleTestModuleFactory</span><span class="o">])</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ExampleTest</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Inject</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">idGenerator</span><span class="k">:</span> <span class="kt">UniqueIdGenerator</span> <span class="o">=</span> <span class="k">_</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Make sure we&#39;re using the UniqueIdGenerator that</span>
</span><span class='line'><span class="cm">   * returns IDs from a known list.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="nd">@Test</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">notUnique</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">assertEquals</span><span class="o">(</span><span class="n">idGenerator</span><span class="o">.</span><span class="n">nextId</span><span class="o">(),</span> <span class="s">&quot;7411c0c8-358c-4e5c-879d-96112806c9aa&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">ExampleTestModuleFactory</span> <span class="k">extends</span> <span class="nc">IModuleFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">createModule</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ITextContext</span><span class="o">,</span> <span class="n">testClass</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="k">_</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="nc">Modules</span><span class="o">.</span><span class="n">`override`</span><span class="o">(</span><span class="k">new</span> <span class="nc">ProductionModuleOne</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProductionModuleTwo</span><span class="o">)</span>
</span><span class='line'>      <span class="o">.</span><span class="n">`with`</span><span class="o">(</span><span class="k">new</span> <span class="nc">ExampleTestModule</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Starting at the top with the <code>@Guice</code> annotation. This identifies the class that TestNG will
use to create the Guice module to provide the dependencies for the test. This class, in
the example ExampleTestModuleFactory, has
to extend the IModuleFactory interface and return the module to use from the
<code>createModule(context: ITextContext, testClass: Class[_])</code> method. Instead of a moduleFactory The <code>@Guice</code> annotation can also
be used by simply listing the guice modules <code>@Guice(module = Array(classOf[ProductionModuleOne], classOf[ProductionModuleTwo]))</code> but this doesn&#8217;t allow for replacing production dependencies with test ones.</p>

<p>In ExampleTextModuleFactory the <code>override</code> and <code>with</code> methods on the
<a href="http://google-guice.googlecode.com/git/javadoc/com/google/inject/util/Modules.html">Modules</a> and
<a href="http://google-guice.googlecode.com/git/javadoc/com/google/inject/util/Modules.OverriddenModuleBuilder.html">OverriddenModuleBuilder</a>
classes are used to combine the production dependencies and then override some of them with test dependencies.
The bindings in the ExampleTestModule override those for the same key in the production modules.
This lets you replace just the dependencies you need with test ones without having to replicate the complete production configuration.
Backticks must be used around override and with because they are reserved words in Scala.</p>

<p>To use the dependencies you just need to add the <code>@Inject</code> annotation to the test class to inject values for variables, as in the example.
Unfortunately you can&#8217;t inject parameters into test methods using Guice, you have to use TestNG&#8217;s facilities for that.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/16/using-spring-transaction-support-with-scala/">Using Spring Transaction Support With Scala</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-16T14:30:00-05:00" pubdate data-updated="true">Mar 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>What&#8217;s the best way to use <a href="http://www.springsource.org/">Spring</a>&#8217;s <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/transaction.html">transaction management</a> features from a Scala program? This is my second attempt to come up with an answer to that question.</p>

<p>My preference for Spring transactions with Java is to use the <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/transaction.html#transaction-declarative-annotations">@Transactional</a> annotation. I&#8217;d like to be able to achieve the same effect in Scala.</p>

<p>The intention for the Java annotations, and what we want in Scala, is to</p>

<ul>
<li>Have some piece of code execute inside a transaction.</li>
<li>Be able to specify the behavior of the transaction.</li>
<li>Don&#8217;t overwhelm the rest of the funactionality with the transactional code.</li>
</ul>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/16/using-spring-transaction-support-with-scala/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/10/finagling/">Finagling</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-10T16:08:00-06:00" pubdate data-updated="true">Mar 10<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been playing with <a href="http://twitter.github.com/finagle/">Finagle</a>, or &#8220;Finagle, from Twitter&#8221; as the site refers to it, to see whether it will work for me as a framework to support a simple http rpc/rest server. The Finagle documentation is good but I wanted to explore in a complete simple example how I could implement</p>

<ul>
<li>Catching execptions from underlying services and returning 500 response codes to clients.</li>
<li>Returning a timeout response if the underlying service takes too long to respone.</li>
<li>Separating common process, such as extracting values from headers, from more specific service handling.</li>
<li>Mapping from urls to services.</li>
<li>Executing service code on a separate thread from the request processing thread.</li>
</ul>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/10/finagling/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/12/rotating-to-show-different-ios-views/">Rotating to Show Different iOS Views</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-12T20:11:00-06:00" pubdate data-updated="true">Feb 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the tradition of explaining fairly simple things at great length this approach is based on the documentation from Apple describing <a href="https://developer.apple.com/library/ios/#featuredarticles/ViewControllerPGforiPhoneOS/RespondingtoDeviceOrientationChanges/RespondingtoDeviceOrientationChanges.html#//apple_ref/doc/uid/TP40007457-CH7-SW1">Creating an Alternate Landscape Interface</a> and various answers on <a href="http://stackoverflow.com/">stackoverflow</a>. It differs from the information I could find on the internet because the flow includes a navigation controller and uses a storyboard. The flow between the screens in the interface is shown in the diagram below.</p>

<p><img src="/images/2012-02-12-ios-views.png" alt="Flow" /></p>

<p>There is a first screen, A, that has two alternate views, one portrait and one landscape. These can&#8217;t be created using the springs and struts layout tools. Rotating the  phone while screen A is showing should switch between the two views. Tapping some element on screen A, in either view, transitions to screen B. Screen B handles rotation itself by redrawing its interface in drawRect:. Going back from B should show the correct version of A. There&#8217;s a navigation controller wrapping the whole interface that provides the navigation bar and button in view B to go back to view A.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/02/12/rotating-to-show-different-ios-views/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/03/23/handling-dependency-injection-in-scala-test-cases-with-testng/">Handling Dependency Injection in Scala test cases with TestNG</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/16/using-spring-transaction-support-with-scala/">Using Spring transaction support with Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/10/finagling/">Finagling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/12/rotating-to-show-different-ios-views/">Rotating to show different iOS views</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - vast.com -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
